# UUID UDFs for MySQL / MariaDB

Provides UUID_TO_BIN and BIN_TO_UUID functions like the ones present in MySQL 8 / MariaDB 10.8

## Description of UDFs

### UUID_TO_BIN(string_uuid), UUID_TO_BIN(string_uuid, swap_flag)

Converts a string UUID to a binary UUID and returns the result. (The IS_UUID() function description lists the permitted string UUID formats.) The return binary UUID is a VARBINARY(16) value. If the UUID argument is NULL, the return value is NULL. If any argument is invalid, an error occurs.

UUID_TO_BIN() takes one or two arguments:

* The one-argument form takes a string UUID value. The binary result is in the same order as the string argument.

* The two-argument form takes a string UUID value and a flag value:

  * If swap_flag is 0, the two-argument form is equivalent to the one-argument form. The binary result is in the same order as the string argument.

  * If swap_flag is 1, the format of the return value differs: The time-low and time-high parts (the first and third groups of hexadecimal digits, respectively) are swapped. This moves the more rapidly varying part to the right and can improve indexing efficiency if the result is stored in an indexed column.

Time-part swapping assumes the use of UUID version 1 values, such as are generated by the UUID() function. For UUID values produced by other means that do not follow version 1 format, time-part swapping provides no benefit. For details about version 1 format, see the UUID() function description.

### BIN_TO_UUID(binary_uuid), BIN_TO_UUID(binary_uuid, swap_flag)

BIN_TO_UUID() is the inverse of UUID_TO_BIN(). It converts a binary UUID to a string UUID and returns the result. The binary value should be a UUID as a VARBINARY(16) value. The return value is a utf8 string of five hexadecimal numbers separated by dashes. (For details about this format, see the UUID() function description.) If the UUID argument is NULL, the return value is NULL. If any argument is invalid, an error occurs.

BIN_TO_UUID() takes one or two arguments:

* The one-argument form takes a binary UUID value. The UUID value is assumed not to have its time-low and time-high parts swapped. The string result is in the same order as the binary argument.

* The two-argument form takes a binary UUID value and a swap-flag value:

  * If swap_flag is 0, the two-argument form is equivalent to the one-argument form. The string result is in the same order as the binary argument.

  * If swap_flag is 1, the UUID value is assumed to have its time-low and time-high parts swapped. These parts are swapped back to their original position in the result value.

For usage examples and information about time-part swapping, see the UUID_TO_BIN() function description.

## Compiling

`gcc -fPIC -I/usr/include/mysql/server -shared -o uuid.so src/uuid.c`

## Installing

Copy the resulting `uuid.so` file to the MySQL or MariaDB plugin directory, typically `/usr/lib64/mysql/plugin`. You can find the server's plugin directory via the SQL `SHOW VARIABLES LIKE '%plugin%';`

Create the functions inside of MySQL / MariaDB with the following commands:

```sql
CREATE FUNCTION uuid_to_bin RETURNS STRING SONAME 'uuid.so';
CREATE FUNCTION bin_to_uuid RETURNS STRING SONAME 'uuid.so';
```

## Upgrading / Uninstalling

Before replacing or deleting the library created above, remove the functions from MySQL / MariaDB with the following commands:

```sql
DROP FUNCTION uuid_to_bin;
DROP FUNCTION bin_to_uuid;
```

